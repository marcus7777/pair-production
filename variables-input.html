<link rel="import" href="input-save.html">
<link rel="import" href="../paper-material/paper-material.html">
<!--
`<variables-input>` 
-->

<dom-module id="variables-input">
  <template>
    <div style="padding:20px"> <h3>{{label}}</h3>
      <input-save path="{{cat('variables.',label)}}" label="{{cat('Variables for ',label)}}" value="{{variables}}" pattern="[a-zA-Z]*[a-zA-Z\,]*[a-zA-Z]+" auto-validate  error-message="a ',' separated list "></input-save>
      <template is="dom-repeat" items="{{variableList}}" >
        <div style="padding:20px"> <h4>{{item}}</h4>
          <input-save path="{{cat('variable.',label,'.',item,'.about')}}" label="{{cat('Tell me about ',item)}}"></input-save>
          <input-save path="{{cat('variable.',label,'.',item,'.type')}}" value="{{type}}" type ></input-save>
          <input-save label="{{cat('default for ',item)}}" pattern="{{repType}}" auto-validate path="{{cat('variable.',label,'.',item,'.default')}}" error-message="{{cat('needs to be a ',type,' so ', repType)}}" ></input-save>
          <template is="dom-if" if="{{computed}}">
            <input-save label="{{cat(item,' is computed by :')}}"  auto-validate path="{{cat('variable.',label,'.',item,'.computed')}}" pattern="{{reFunctionsAndVariables}}" error-message="{{cat('needs to a function (', functions , ') with input(s)')}}"></input-save>
          </template>
          <input-save label="{{cat('observer ',item)}}" auto-validate path="{{cat('variable.',label,'.',item,'.observer')}}" pattern="{{reFunctions}}" error-message="{{cat('needs to a function (', functions , ') add to \'functions'\' if needed)}}"></input-save>
        </paper-material>
      </template>
    </paper-material>
  </template>
</dom-module> 
<script>
  (function () {
    toCamelCase = function(str){
      return str.replace(/ \S/g, function(txt){return txt.toUpperCase()[1]});
    }
    Polymer({
      is: 'variables-input',
      properties:{
        label:String,
        variables: {
          type:String,
          notify:true
        },
        type:String,
        variableList: {
          computed:"getArray(variables)"
        },
        repType: {
          computed:"getRepType(type)"
        },
        computed: {
          computed:"notInput(label)"
        },
        functions:{
          type:String
        },
        reFunctions: {
          computed:"getReFunctions(functions)"
        },
        reFunctionsAndVariables: {
          computed:"getReFunctionsAndVariables(reFunctions)"
        }
      },
      notInput (label) {
        return label !== "Inputs"
      },
      cat (a,b,c,d,e,f) {
        console.log(a,b,c,d,e,f);
        if (c === undefined) {
          return a+b;
        } else if (d === undefined) {
          return a+b+c;
        } else if (e === undefined) {
          return a+b+c+d;
        } else if (f === undefined) {
          return a+b+c+d+e;
        } else {
          return a+b+c+d+e+f;
        }
      },
      getArray (s) {
        if (s !== "") return toCamelCase(s).split(',');
      },
      getRepType(t) {
        console.log("t",t);
        switch(t) {
           // TODO Symbol
          case 'Null':
            return 'Null';
          break;
          case 'Array':
            return '^\\[.*\\]$';
          break;
          case 'Boolean':
            return '(true|false)';
          break;
          case 'Number':
            return '^[0-9\.]*$';
          break;
          case 'Object':
            return '^\{.*\}$';
          break;
          case 'String':
            return '^\".*\"$';
          break;
          default:
            return '';
        }
      },
      getReFunctions(functions){
        console.log("functions",functions);
        return '(' + functions.replace(/,/g, '|') + ')';
      },
      getReFunctionsAndVariables(reFunctions) {
        console.log("ReFunctionsAndVariables",reFunctions+'\([a-zA-Z]*[a-zA-Z\,]*[a-zA-Z]+\)');
        return reFunctions+'\\([a-zA-Z]*[a-zA-Z\,]*[a-zA-Z]+\\)'
      }
    });
  })();  
</script>
