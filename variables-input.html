<link rel="import" href="../paper-button/paper-button.html">
<!--
`<variables-input>` 
-->

<dom-module id="variables-input">
  <template>
    <div style="padding:20px"> <h3>{{label}}</h3>
      <paper-input value="{{addMe}}"></paper-input> <paper-button on-tap="add">Add</paper-button>
      <template is="dom-repeat" items="{{value}}">
        <div style="padding:20px"> <h4>{{item.name}}</h4>
          <input-save value="{{item.about}}" label="{{cat('Tell me about ',item)}}"></input-save>
          <input-save value="{{item.type}}" options-input></input-save>
          <input-save value="{{item.value}}" label="{{cat('default for ',item)}}" pattern$="{{getRepType('variable.',label,'.',item,'.type',data)}}" auto-validate error-message="{{cat('needs to be a ',type,' so ', repType)}}"></input-save>
          <template is="dom-if" if="{{computed}}">
            <input-save value="{{item.computed}}" label="{{cat(item,' is computed by :')}}" auto-validate pattern="{{reFunctionsAndVariables}}" error-message="{{cat('needs to a function (', functions , ') with input(s)')}}"></input-save>
          </template>
          <input-save value="{{item.observer}}" label="{{cat('observer ',item)}}" auto-validate pattern="{{reFunctions}}" error-message="{{cat('needs to a function (', functions , ') add to \'functions'\' if needed)}}"></input-save>
        </div>
      </template>
    </div>
  </template>
</dom-module> 
<script>
    Polymer({
      is: 'variables-input',
      properties:{
        label:String,
        changed: {type:Boolean,notify:true,value:false},
        variables: {type:String,notify:true},
        type: String,
        computed: {computed:"notInput(label)"},
        functions:{type:String},
        reFunctions: {computed:"getReFunctions(functions)"},
        reFunctionsAndVariables: {computed:"getReFunctionsAndVariables(reFunctions)"},
        value:{notify:true,observer: "checkValue"} 
      },
      add: function(){
        this.value.push({ name: this.addMe })
      },
      checkValue: function(value) {
        if (!value) {
          this.value = [{}]
        }
      },
      notInput: function(label) {
        return label !== "Inputs"
      },
      cat : function(a,b,c,d,e,f) {
        console.log(a,b,c,d,e,f);
        if (c === undefined) {
          return a+b;
        } else if (d === undefined) {
          return a+b+c;
        } else if (e === undefined) {
          return a+b+c+d;
        } else if (f === undefined) {
          return a+b+c+d+e;
        } else {
          return a+b+c+d+e+f;
        }
      },
      getArray:  function(s) {
        if (s !== "") return toCamelCase(s).split(',');
      },
      getRepType: function(a,b,c,d,e,data) {
        var t = data[a+b+c+d+e];

        console.log("t",t);
        
        switch(t) {
           // TODO Symbol Functions
          case 'Null': return 'null';break;
          case 'Array': return '^\\[.*\\]$';break;
          case 'Boolean': return '(true|false)';break;
          case 'Number': return '^[0-9\.]*$';break;
          case 'Object': return '^\{.*\}$';break;
          case 'String': return '^\".*\"$';break;
          default: return '';break;
        }

      },
      getReFunctions: function(functions){return '(' + functions.replace(/,/g, '|') + ')';},
      getReFunctionsAndVariables: function(reFunctions) {return reFunctions+'\\([a-zA-Z]*[a-zA-Z\,]*[a-zA-Z]+\\)'}
    });
</script>
