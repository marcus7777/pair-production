<link rel="import" href="../paper-input/paper-textarea.html">
<link rel="import" href="../paper-input/paper-input.html">
<link rel="import" href="../paper-card/paper-card.html">
<link rel="import" href="../iron-doc-viewer/iron-doc-viewer.html">
<link rel="import" href="../prism-element/prism-highlighter.html">
<link rel="import" href="../marked-element/marked-element.html">

<link rel="import" href="variables-list-input.html">
<link rel="import" href="type-selection.html">
<link rel="import" href="function-list-input.html">
<link rel="import" href="variables-input.html">
<link rel="import" href="input-save.html">
<!--
`<pair-production>` 
@demo demo.html
@hero hero.svg
-->
<dom-module id="pair-production">
  <template>
    <div class="vertical center-justified layout">
      <h4>Let me help you conjure a new element:</h4>
        <input-save path="name" label="Name the new element - like pirate-ninja" value="{{name}}" pattern="[a-z]+-[a-z\-]*[a-z]+" auto-validate  error-message="Need's to have a '-' between lowercase letters "></input-save>
        <template is="dom-if" if="{{name}}">
          <paper-textarea value="{{description}}" label="{{cat('Tell me about <', name,'/> element')}}"></paper-textarea>

          <variables-list-input functions="{{functions}}" label="Inputs,Outputs,Internal" path="" name="{{name}}" variables="{{variables}}" ></variables-list-input>   
          <input-save path="dependencies" label="what are the elements will your element need" value="{{dependencies}}" pattern="[a-zA-Z\/]*[a-zA-Z\/\,]*[a-zA-Z\/]+" auto-validate  error-message="sorry a ',' separated list "></input-save>
          <input-save path="functions" label="Give me list of functions it will need" value="{{functions}}" pattern="[a-zA-Z]*[a-zA-Z\,]*[a-zA-Z]+" auto-validate  error-message="sorry a ',' separated list "></input-save>
          <template is="dom-repeat" items="{{functionList}}" >
            <function-list-input variable-list="{{variableList}}" name="{{item}}"></function-list-input>   
          </template>
      </template>
    </div>
    <prism-highlighter></prism-highlighter>
    your code:
    <marked-element markdown="{{markdown}}"></marked-element>
    your docs:
    <!-- <iron-doc-viewer descriptor="{{descriptor}}"></iron-doc-viewer> -->
  </template>
</dom-module>
<script>
(function () {
  var at = 0;
  var tabs = function(n) {
    var output = "";
   
    if (+n < 0) { at += n; }
    for (var i = 0; i < at; ++i) {
      output += "  ";
    }
    if (+n > 0) { at += n; }
    return output;
  };
  
  var addLine = function(nl){
    output = [];
    for (var i = 0; i < nl.length; ++i) {
      output.push('\n'+nl[i]);
    }
    return output;
  };
  
  Polymer({
      is: 'pair-production',
      properties:{
        name : {
          type: String,
          value: ""
        },
        description :{
          type: String,
          value: ""
        },
        functions: String,
        functionList: {
          computed: "getArray(functions)"
        },
        variables : {
          type:String,
          value: ""
        },
        variableList : {
          type: Array,
          computed: "getArray(variables)"
        },
        dependencies:{
          type:String,
          value: "polymer"
        },
        dependencylist: {
          computed: "getArray(dependencies)"
        },
        demo: {
          computed: "getCode(head,body)"
        },
        head: {
          computed: "getHead(name)"
        },
        body: {
          computed: "getBody(name)"
        },
        element: {
          computed: "getElementCode(name, description, dependencylist, variableList, functionList)"
        },
        descriptor: {
          computed: "getDescriptor(element,demo)"
        },
        markdown: {
          computed: "getMarkdown(demo,element,name,bower)"
        },
        getBower :{
          computed: "getBower(name,dependencylist)"
        }
        
      },
      cat (a,b,c) {
        return a+b+c;
      },
      getArray (s) {
        return s.split(',');
      },
      getCode(head,body) {
        at = 0;
        var output = [
          tabs() + '<!doctype html>',
          tabs(1) + '<html>'
        ];        
        for (var i = 0; i < head.length; ++i) {
          output.push(tabs() +head[i]);
        }
        for (var i = 0; i < body.length; ++i) {
          output.push(tabs() +body[i]);
        }
        output.push(tabs(-1) + '</html>');
        return addLine(output);
      },
      getHead(name) {
        var output = [
          tabs(1) + '<head>',
          tabs()+'<title>'+name+' demo</title>',
          tabs()+'<sc'+'ript src="../webcomponentsjs/webcomponents-lite.js"></sc'+'ript>',
          tabs()+'<sc'+'ript src="'+name+'.html"></sc'+'ript>'
        ];
        output.push(tabs(-1) + '</head>');
        if (name !== "") return output ;
      },
      getBody(name) {
        var output = [
          tabs(1)+ '<body>',
          tabs()+ '<h1>' + name + ' Demo</h1>',
          tabs()+ '<' + name + '></' + name + '>',
          tabs(-1)+ '</body>'
        ];
        
        if (name !== "") return output;
      },
      getElementCode(name, description, dependencylist, variableList, functionList) {
        var output = [
          tabs()+ '<!--',
          tabs()+ '`<'+name+'>` ' + description,
          tabs()+ '@demo demo.html',
          tabs()+ '-->','',
          tabs(1)+ '<dom-module id="'+name+'">',
          tabs(1)+ '<template>',     
          tabs()+ '<style></style>',
          tabs()+ '<h2>Hello from '+name+'</h2>',
          tabs(-1)+ '</template>',
          tabs(-1)+ '</dom-module>',
          tabs(1)+ '<sc'+'ript>',
          tabs(1)+ 'Polymer({'
        ];
        if (variableList.length > 0 && variableList[0] !== "") {
          output.push(tabs()+ 'is: "'+name+'",');
          output.push(tabs(1) + 'properties: {');
          var comma = ","
          for (var i = 0; i < variableList.length; ++i) {
            if (variableList.length -1 === i) comma = "";
            
                output.push(tabs(0)+'/** '+element_kvp[variableList[i]]+ '*/' );
            if (element_kvp[variableList[i]] !== undefined){
              output.push(tabs(0) +''+ variableList[i]+':'+element_kvp[variableList[i]]+comma);
            } else {
              output.push(tabs(0) +''+ variableList[i]+comma);
            }
          }
          output.push(tabs(-1) + '},');
        } else {
          output.push(tabs()+ 'is: "'+name+'"')
        }
        
        output.push(tabs(-1) + '});');
        output.push(tabs(-1) + '</sc'+'ript>');
       
        for (var i = 0; i < dependencylist.length; ++i) {
          output.unshift(tabs(0) + '<link rel="import" href="../'+dependencylist[i]+'/'+dependencylist[i]+'.html">');
        }
        return addLine(output); 
      },
      getDescriptor(element,demo) {
        return {
          "desc": "This is an example of how `iron-doc-viewer` will render various types of\ninformation. You can use it as a style guide to see how various data will be\nrepresented. Markdown is used to format descriptive text throughout.\n\n# Level 1 Heading\n\nThis is a level one heading. **Bold text** and *italic text* are represented\nappropriately. [Links](#) have black underlines.\n\n## Level 2 Heading\n\nThis is a level two heading. `inline code` can be represented.\n\n    <html>\n      <p>This is a code block. Its syntax is highlighted automatically.</p>\n    </html>\n\n### Level 3 Heading\n\nLists can also be used as you'd expect:\n\n* Unordered Lists\n  * With Nesting\n* Or without nesting\n\nYou can also use ordered lists:\n\n1. First item\n2. Second item\n\n#### Level 4 Heading\n\nHeadings can be used all the way down to level 5.\n\n##### Level 5 Heading\n\nThis concludes our quick rundown of the various styles that you can commonly use."
        }
      },
      getMarkdown(demo, element, name, bower) {
        return 'demo.html\n\n ```html \n'+demo.join('') +'\n```\n' + name + '.html\n\n```html \n'+element.join('')+'\n``` \nbower.json\n ```\n'+bower+'\n```';
      }
    });
  })();
</script>
