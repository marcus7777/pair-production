<link rel="import" href="../paper-input/paper-input.html">
<link rel="import" href="../iron-localstorage/iron-localstorage.html">
<!--
`<input-save>`  
-->
<dom-module id="input-save">
  <template>
    <template is="dom-if" if="{{!textarea}}">
      <paper-input label="{{label}}" value="{{value}}" pattern="{{pattern}}" error-message="{{errorMessage}}" auto-validate="{{autoValidate}}"></paper-input>
    </template>
    <template is="dom-if" if="{{textarea}}">
      <paper-textarea label="{{label}}" value="{{value}}" pattern="{{pattern}}" error-message="{{errorMessage}}" auto-validate="{{autoValidate}}"></paper-textarea>
    </template>

    <iron-localstorage on-iron-localstorage-load-empty="initializeDefault" name="pair-production" value="{{data}}"></iron-localstorage>
  </template>
</dom-module>
<script>
  
  Polymer({
    is: 'input-save',
    properties: {
      name: String,
      path: String,
      textarea:Boolean,
      label: String,
      pattern: String,
      autoValidate: Boolean,
      errorMessage: String,
      value: {
        type:String,
        notify:true
      },
      data: {
        type:Object,
        observer:"dataChanged"
      },
      element: { // move to observers
        computed:'saveThis(path,value)'
      }
    },
    initializeDefault(ev){
      if (this.data === undefined) {
        this.data = {};
      }
      this.data[this.path] = ""; 
      this.loaded = true;
      return data;
    },
    saveThis (path,value) {
      js_data[path] = value;
      if (this.loaded === true) {
        if (this.data === undefined || this.data === null) {
          this.data = {};
        }
        this.data = js_data;
      }
      return js_data;
    },
    dataChanged(loading_data) {
      if ((loading_data !== undefined || loading_data !== null) && loading_data.hasOwnProperty(this.path)) {
        this.value = loading_data[this.path];
        this.loaded = true;
      }
    }
  });
  var js_data = {};
</script>
